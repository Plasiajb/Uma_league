{% extends "guest/base.html" %}

{% block title %}{{ player.name }} - 个人主页{% endblock %}

{% block content %}
<h2 class="mb-1">{{ player.name }}</h2>
<p class="text-muted">个人主页</p>

<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">个人简介 & 荣誉</h5>
    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        <label for="bio" class="form-label">简介：</label>
        <textarea id="bio" name="bio" rows="3" class="form-control" {% if not can_edit_honors %}readonly{% endif %}>{{ bio }}</textarea>
      </div>

      <h6 class="mt-4">荣誉：</h6>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="honor_umaleague_season_champ" id="honor1" {% if player.honor_umaleague_season_champ %}checked{% endif %} {% if not can_edit_honors %}disabled{% endif %}>
        <label class="form-check-label" for="honor1">UMA League 赛季冠军</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="honor_umaleague_stage_champ" id="honor2" {% if player.honor_umaleague_stage_champ %}checked{% endif %} {% if not can_edit_honors %}disabled{% endif %}>
        <label class="form-check-label" for="honor2">UMA League 赛段冠军</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="honor_loh96_hero" id="honor3" {% if player.honor_loh96_hero %}checked{% endif %} {% if not can_edit_honors %}disabled{% endif %}>
        <label class="form-check-label" for="honor3">LOH96 杰</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="honor_aupl_champion" id="honor4" {% if player.honor_aupl_champion %}checked{% endif %} {% if not can_edit_honors %}disabled{% endif %}>
        <label class="form-check-label" for="honor4">AUPL 冠军</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="honor_nxns_champion" id="honor5" {% if player.honor_nxns_champion %}checked{% endif %} {% if not can_edit_honors %}disabled{% endif %}>
        <label class="form-check-label" for="honor5">NXNS 冠军</label>
      </div>
      
      <div class="form-check form-switch mt-4">
        <input class="form-check-input" type="checkbox" role="switch" name="public_results" id="public_results" {% if player.public_results %}checked{% endif %} {% if not can_edit_honors %}disabled{% endif %}>
        <label class="form-check-label" for="public_results">允许他人查看我的历史战绩与总奖金</label>
      </div>

      {% if can_edit_honors %}
        <button type="submit" class="btn btn-primary mt-3">保存</button>
      {% else %}
        <p class="text-muted small mt-3">（仅本人或管理员可编辑）</p>
      {% endif %}
    </form>
  </div>
</div>

{% if can_view_private %}
  <div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">总奖金</h5>
        <p class="card-text fs-4 fw-bold text-success">{{ payout_sum|floatformat:2 }}</p>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5 class="card-title">历史战绩</h5>
      {% if events_detail %}
        {% for it in events_detail %}
          <div class="mb-4">
            <h6>{{ it.event.name }}</h6>
            <small class="text-muted">名次：{{ it.rank }} ｜ 累计积分：{{ it.total_score }}</small>
            {% if it.rows %}
              <table class="table table-sm table-bordered mt-2">
                <thead>
                  <tr><th>轮次</th><th>组别</th><th>马#</th><th>名次</th></tr>
                </thead>
                <tbody>
                  {% for r in it.rows %}
                    <tr>
                      <td>{{ r.round_no }}</td>
                      <td>{{ r.group }}</td>
                      <td>{{ r.horse_no }}</td>
                      <td>{{ r.place }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            {% else %}
              <p class="text-muted small">（暂无每轮明细）</p>
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">（该选手暂无参赛记录）</p>
      {% endif %}
    </div>
  </div>
{% else %}
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">总奖金 & 历史战绩</h5>
      <p class="text-muted">（该选手已选择隐藏战绩）</p>
    </div>
  </div>
{% endif %}

<div class="mt-4">
    <a href="{% url 'players' %}" class="btn btn-secondary btn-sm"><i class="bi bi-arrow-left"></i> 返回选手列表</a>
</div>
{% endblock %}