{% extends "guest/base.html" %}
{% load turf_extras %}  {% block title %}{{ event.name }} - 战绩填报{% endblock %}

{% block content %}
<h2 class="mb-3">战绩填报：{{ event.name }}</h2>

<div class="alert alert-info" role="alert">
  <i class="bi bi-info-circle-fill me-2"></i>
  <strong>说明：</strong>
  {% if horses == 1 %}
    每轮填写 <b>1</b> 个名次（前哨战）。
  {% else %}
    每轮填写 <b>2</b> 个名次（结算/Final）。
  {% endif %}
  名次必须是 1-12 之间的整数。
</div>

<form method="post">
  {% csrf_token %}
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th class="text-center">轮次</th>
          <th class="text-center">所属组</th>
          <th class="text-center">马1名次</th>
          {% if horses == 2 %}<th class="text-center">马2名次</th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for m in memberships %}
          {% with key1="r"|add:m.round_no|add:"_h1" key2="r"|add:m.round_no|add:"_h2" %}
          <tr>
            <td class="text-center">第 {{ m.round_no }} 轮</td>
            <td class="text-center">{{ m.group.name }}</td>
            <td>
              <input type="number" name="r{{ m.round_no }}_h1" class="form-control" min="1" max="12"
                     value="{{ prefill|get_item:key1 }}" placeholder="1-12">
            </td>
            {% if horses == 2 %}
            <td>
              <input type="number" name="r{{ m.round_no }}_h2" class="form-control" min="1" max="12"
                     value="{{ prefill|get_item:key2 }}" placeholder="1-12">
            </td>
            {% endif %}
          </tr>
          {% endwith %}
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-4">
    <button type="submit" class="btn btn-primary"><i class="bi bi-check-circle me-2"></i>提交</button>
    <a href="{% url 'event_detail' event.id %}" class="btn btn-secondary">返回赛事页</a>
  </div>
</form>
{% endblock %}